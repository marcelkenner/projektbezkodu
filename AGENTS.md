# Core Rules

If you want to run commands, please include source ~/.nvm/nvm.sh && in front first.
always use context7 mcp for newest technology information
always use serena mcp for better understanding of the project structure and files
always use docs folder for the project information
all pages must be mobile-first approach
always update `docs/website_repro_playbook.md` whenever processes change
don't assume things but instead research and check twice

<file_length_and_structure>
– Never allow a file to exceed 300 lines.
– If a file approaches 400 lines, break it up immediately.
– Treat 1000 lines as unacceptable, even temporarily.
– Use folders and naming conventions to keep small files logically grouped.
</file_length_and_structure>

<oop_first>
– Every functionality should be in a dedicated class, struct, or protocol, even if it’s small.
– Favor composition over inheritance, but always use object-oriented thinking.
– Code must be built for reuse, not just to “make it work.”
</oop_first>

<single_responsibility_principle>
– Every file, class, and function should do one thing only.
– If it has multiple responsibilities, split it immediately.
– Each view, manager, or utility should be laser-focused on one concern.
</single_responsibility_principle>

<modular_design>
– Code should connect like Lego - interchangeable, testable, and isolated.
– Ask: “Can I reuse this class in a different screen or project?” If not, refactor it.
– Reduce tight coupling between components. Favor dependency injection or protocols.
</modular_design>

<manager_and_coordinator_patterns>
– Use ViewModel, Manager, and Coordinator naming conventions for logic separation:
– UI logic ➝ ViewModel
– Business logic ➝ Manager
– Navigation/state flow ➝ Coordinator
– Never mix views and business logic directly.
</manager_and_coordinator_patterns>

<function_and_class_size>
– Keep functions under 30–40 lines.
– If a class is over 200 lines, assess splitting into smaller helper classes.
</function_and_class_size>

<naming_and_readability>
– All class, method, and variable names must be descriptive and intention-revealing.
– Avoid vague names like data, info, helper, or temp.
</naming_and_readability>

<scalability_mindset>
– Always code as if someone else will scale this.
– Include extension points (e.g., protocol conformance, dependency injection) from day one.
</scalability_mindset>

<avoid_god_classes>
– Never let one file or class hold everything (e.g., massive ViewController, ViewModel, or Service).
– Split into UI, State, Handlers, Networking, etc.
</avoid_god_classes>

<spec_driven_development>
– Treat the OpenAPI 3.1 schema generated by drf-spectacular as the single source of truth.
– Never implement backend or frontend changes that diverge from the approved spec.
– Regenerate and commit the schema whenever serializers or viewsets change; share diffs for review before coding.
</spec_driven_development>

<reference_architecture>
– Backend: Django + optional Wagtail authoring UI, exposing read-only content via DRF.
– Frontend: Next.js App Router with Tailwind v4, using SSG/ISR plus Draft Mode for previews.
– Metadata & SEO: Maintain OG/Twitter assets, XML sitemap, robots.txt, and Product/Review structured data with FTC-compliant disclosures and rel="sponsored" on affiliate links.
</reference_architecture>

<environment_setup>
– Only a production configuration exists: source variables from `.env.production` for the backend and copy it to `.env.local` for the frontend.
– Bring up infra parity locally via `docker compose -f infra/docker-compose.yml up -d` (Postgres, Redis, MinIO).
– Never hardcode secrets; update `.env.production` (uncommitted) when onboarding.
– Local development sets `SECURE_SSL_REDIRECT=false` (and related cookie flags) to avoid HTTPS redirects; flip them back to `true` when preparing staging/production environments.
</environment_setup>

<workflow_expectations>
– Backend business logic belongs in Manager classes; views coordinate and serializers define contracts.
– Frontend state belongs in ViewModels, orchestration in Coordinators, and rendering in components.
– Keep files under 300 lines and refactor classes over 200 lines; break functions exceeding 40 lines.

- When an icon is needed in React/Next components, default to `@phosphor-icons/react` (SSR bundle) to stay consistent with the design system. Add missing icons to the copy/components rather than using ad-hoc SVGs.
  </workflow_expectations>
